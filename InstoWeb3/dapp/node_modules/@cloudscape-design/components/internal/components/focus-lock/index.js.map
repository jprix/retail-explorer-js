{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/internal/components/focus-lock/index.tsx"],"names":[],"mappings":"AAAA,qEAAqE;AACrE,sCAAsC;AACtC,OAAO,KAAK,EAAE,EAAE,WAAW,EAAE,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AACxE,OAAO,EAAE,YAAY,EAAE,MAAM,4BAA4B,CAAC;AAE1D,OAAO,OAAO,MAAM,mBAAmB,CAAC;AACxC,OAAO,EAAE,iBAAiB,EAAE,gBAAgB,EAAE,MAAM,SAAS,CAAC;AAU9D,MAAM,CAAC,OAAO,UAAU,SAAS,CAAC,EAA0E;QAAxE,SAAS,eAAA,EAAE,QAAQ,cAAA,EAAE,SAAS,eAAA,EAAE,YAAY,kBAAA,EAAE,QAAQ,cAAA;IACxF,IAAM,gBAAgB,GAAG,MAAM,CAA0B,IAAI,CAAC,CAAC;IAC/D,IAAM,YAAY,GAAG,MAAM,CAAwB,IAAI,CAAC,CAAC;IAEzD,0FAA0F;IAC1F,IAAM,mBAAmB,GAAG,WAAW,CACrC,UAAC,IAA2B;;QAC1B,IAAI,IAAI,KAAK,IAAI,IAAI,YAAY,EAAE;YACjC,MAAA,gBAAgB,CAAC,OAAO,0CAAE,KAAK,EAAE,CAAC;SACnC;IACH,CAAC,EACD,CAAC,YAAY,CAAC,CACf,CAAC;IAEF,IAAM,SAAS,GAAG,YAAY,CAAC,YAAY,EAAE,mBAAmB,CAAC,CAAC;IAElE,IAAM,UAAU,GAAG;;QACjB,IAAI,YAAY,CAAC,OAAO,EAAE;YACxB,MAAA,iBAAiB,CAAC,YAAY,CAAC,OAAO,CAAC,0CAAE,KAAK,EAAE,CAAC;SAClD;IACH,CAAC,CAAC;IAEF,IAAM,SAAS,GAAG;;QAChB,IAAI,YAAY,CAAC,OAAO,EAAE;YACxB,MAAA,gBAAgB,CAAC,YAAY,CAAC,OAAO,CAAC,0CAAE,KAAK,EAAE,CAAC;SACjD;IACH,CAAC,CAAC;IAEF,SAAS,CAAC;QACR,IAAI,SAAS,IAAI,CAAC,QAAQ,EAAE;YAC1B,gBAAgB,CAAC,OAAO,GAAG,QAAQ,CAAC,aAAwC,CAAC;YAC7E,UAAU,EAAE,CAAC;SACd;IACH,CAAC,EAAE,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC,CAAC;IAE1B,0DAA0D;IACpD,IAAA,KAAkC,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,EAArD,YAAY,QAAA,EAAE,eAAe,QAAwB,CAAC;IAC7D,SAAS,CAAC;;QACR,IAAI,YAAY,KAAK,CAAC,CAAC,QAAQ,EAAE;YAC/B,eAAe,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;YAC5B,IAAI,QAAQ,IAAI,YAAY,EAAE;gBAC5B,MAAA,gBAAgB,CAAC,OAAO,0CAAE,KAAK,EAAE,CAAC;gBAClC,gBAAgB,CAAC,OAAO,GAAG,IAAI,CAAC;aACjC;SACF;IACH,CAAC,EAAE,CAAC,YAAY,EAAE,QAAQ,EAAE,YAAY,CAAC,CAAC,CAAC;IAE3C,OAAO,CACL;QACE,oBAAC,OAAO,IAAC,QAAQ,EAAE,QAAQ,EAAE,iBAAiB,EAAE,SAAS,GAAI;QAC7D,6BAAK,SAAS,EAAE,SAAS,EAAE,GAAG,EAAE,SAAS,IACtC,QAAQ,CACL;QACN,oBAAC,OAAO,IAAC,QAAQ,EAAE,QAAQ,EAAE,iBAAiB,EAAE,UAAU,GAAI,CAC7D,CACJ,CAAC;AACJ,CAAC","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useMergeRefs } from '../../hooks/use-merge-refs';\n\nimport TabTrap from '../tab-trap/index';\nimport { getFirstFocusable, getLastFocusable } from './utils';\n\nexport interface FocusLockProps {\n  className?: string;\n  disabled?: boolean;\n  autoFocus?: boolean;\n  restoreFocus?: boolean;\n  children: React.ReactNode;\n}\n\nexport default function FocusLock({ className, disabled, autoFocus, restoreFocus, children }: FocusLockProps) {\n  const returnFocusToRef = useRef<HTMLOrSVGElement | null>(null);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  // Using a callback ref to detect component unmounts, which is safer than using useEffect.\n  const restoreFocusHandler = useCallback(\n    (elem: HTMLDivElement | null) => {\n      if (elem === null && restoreFocus) {\n        returnFocusToRef.current?.focus();\n      }\n    },\n    [restoreFocus]\n  );\n\n  const mergedRef = useMergeRefs(containerRef, restoreFocusHandler);\n\n  const focusFirst = () => {\n    if (containerRef.current) {\n      getFirstFocusable(containerRef.current)?.focus();\n    }\n  };\n\n  const focusLast = () => {\n    if (containerRef.current) {\n      getLastFocusable(containerRef.current)?.focus();\n    }\n  };\n\n  useEffect(() => {\n    if (autoFocus && !disabled) {\n      returnFocusToRef.current = document.activeElement as HTMLOrSVGElement | null;\n      focusFirst();\n    }\n  }, [autoFocus, disabled]);\n\n  // Returns focus when disabled changes from false to true.\n  const [prevDisabled, setPrevDisabled] = useState(!!disabled);\n  useEffect(() => {\n    if (prevDisabled !== !!disabled) {\n      setPrevDisabled(!!disabled);\n      if (disabled && restoreFocus) {\n        returnFocusToRef.current?.focus();\n        returnFocusToRef.current = null;\n      }\n    }\n  }, [prevDisabled, disabled, restoreFocus]);\n\n  return (\n    <>\n      <TabTrap disabled={disabled} focusNextCallback={focusLast} />\n      <div className={className} ref={mergedRef}>\n        {children}\n      </div>\n      <TabTrap disabled={disabled} focusNextCallback={focusFirst} />\n    </>\n  );\n}\n"]}